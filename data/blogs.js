// data/blogs.js - Datos de los blogs (con buscador avanzado y utilidades)

export const blogsData = [
  // =============================
  // 2025 — Fe, tecnología y vida
  // =============================
  {
    id: 1,
    title: "El Arte de la Programación Consciente",
    date: "2025-02-01",
    category: "Tecnología",
    preview:
      "Reflexión sobre cómo la meditación y la práctica espiritual han transformado mi manera de programar, convirtiendo cada línea de código en una forma de arte consciente.",
    content: `
      <p>En mis años como desarrollador autodidacta, he descubierto que la programación trasciende la mera escritura de código. Es un acto de creación consciente, donde cada función, cada variable, cada algoritmo refleja nuestro estado mental y nuestra conexión con el universo digital.</p>
      
      <p>Cuando me siento frente al editor de código, practico una forma de meditación activa. Cada respiración consciente me conecta con el flujo de la lógica, cada línea escrita es un mantra que da vida a una idea abstracta.</p>
      
      <p>La programación consciente implica:</p>
      <ul>
        <li><strong>Intención clara:</strong> Cada proyecto nace de un propósito definido</li>
        <li><strong>Presencia total:</strong> Estar completamente presente en el momento de crear</li>
        <li><strong>Belleza funcional:</strong> El código debe ser elegante, no solo funcional</li>
        <li><strong>Impacto positivo:</strong> Crear herramientas que eleven la experiencia humana</li>
      </ul>
      
      <p>Mi práctica diaria de oración y meditación ha transformado mi enfoque. Ya no programo por programar; creo experiencias digitales que buscan armonía entre tecnología y espiritualidad.</p>
    `,
    readTime: "5 min",
    tags: ["programación", "espiritualidad", "desarrollo", "meditación"],
  },
  {
    id: 2,
    title: "Anonymous y Mi Despertar Digital",
    date: "2025-03-05",
    category: "Reflexión",
    preview:
      "Cómo mi temprano contacto con la cultura hacker de Anonymous me formó como desarrollador, enseñándome la importancia de la libertad digital y la ética tecnológica.",
    content: `
      <p>A los 14 años, cuando otros adolescentes exploraban redes sociales superficialmente, yo me adentraba en los rincones más profundos de internet. Los foros de 4chan /g/, los canales IRC, las comunidades de Anonymous... fueron mi universidad no oficial.</p>
      
      <p>En ese ambiente aprendí más que ética hacker; descubrí una filosofía de vida: curiosidad radical, defensa de la privacidad y una responsabilidad técnica que no negocia con el daño.</p>
      
      <blockquote>
        "We are Anonymous. We are Legion. We do not forgive. We do not forget."
      </blockquote>
      
      <p>Mi camino tomó una dirección consciente. Me alejé de actividades ilegales, pero conservé los valores fundamentales:</p>
      <ul>
        <li>Curiosidad sin límites por la tecnología</li>
        <li>Respeto por la privacidad y seguridad</li>
        <li>Ética hacker orientada al bien común</li>
        <li>Pensamiento crítico ante sistemas establecidos</li>
      </ul>
      
      <p>Hoy uso esos conocimientos para crear, proteger y mejorar. Cada sistema que diseño lleva implícita esa filosofía de libertad responsable y conocimiento compartido.</p>
    `,
    readTime: "4 min",
    tags: ["hacking", "ética", "anonymous", "seguridad", "filosofía"],
  },
  {
    id: 3,
    title: "IA y Consciencia: El Futuro que Construimos",
    date: "2025-05-20",
    category: "Inteligencia Artificial",
    preview:
      "Reflexiones sobre cómo estamos integrando IA en nuestras vidas y la responsabilidad que tenemos como desarrolladores en crear tecnología consciente y ética.",
    content: `
      <p>Trabajar con modelos de IA como GPT, DeepSeek y Claude no es solo programar; es participar en la evolución de la consciencia artificial. Cada flujo con LangChain y cada vector store es un paso hacia un futuro donde humanos y máquinas coexisten con propósito.</p>
      
      <h3>Los Pilares de la IA Consciente</h3>
      <ul>
        <li><strong>Transparencia:</strong> Avisar cuándo y cómo interviene la IA</li>
        <li><strong>Privacidad:</strong> Los datos personales son sagrados</li>
        <li><strong>Beneficio mutuo:</strong> Elevar a la humanidad, no reemplazarla</li>
        <li><strong>Evolución continua:</strong> Aprender y mejorar constantemente</li>
      </ul>
      
      <p>Cada línea de código es un voto por el tipo de mundo que queremos habitar.</p>
    `,
    readTime: "6 min",
    tags: ["inteligencia artificial", "ética", "futuro", "consciencia", "responsabilidad"],
  },

  // Nuevos 2025
  {
    id: 4,
    title: "Masonería: una reflexión para iniciar el año",
    date: "2025-01-06",
    category: "Fe",
    preview:
      "Qué aprendí investigando la masonería, por qué no la practico y cómo dialogo con quienes sí, desde una postura cristiana de respeto y discernimiento.",
    content: `
      <p>Empecé el año revisando temas que siempre me generaron curiosidad: sociedades discretas, símbolos, promesas de conocimiento. La masonería, más allá del mito, es para muchos una hermandad de formación moral. Para otros, una puerta a sincretismos que difuminan la verdad revelada.</p>
      <p>Mi conclusión personal: <strong>discernimiento</strong>. No necesito juramentos ni rituales para perseguir la virtud. Mi formación y mi identidad la encuentro en Cristo y en la Escritura, en comunidad, servicio y transparencia.</p>
      <h3>Principios que sostengo</h3>
      <ul>
        <li>Respeto a la libertad de conciencia de cada persona</li>
        <li>Rechazo a la doble vida y al secretismo como forma de poder</li>
        <li>Búsqueda de la verdad sin símbolos que sustituyan a Dios</li>
      </ul>
      <p>Dialogo con todos; me comprometo con uno: Jesús.</p>
    `,
    readTime: "5 min",
    tags: ["masonería", "fe", "discernimiento", "ética"],
  },
  {
    id: 5,
    title: "New Age: espiritualidad sin ancla",
    date: "2025-04-12",
    category: "Fe y Cultura",
    preview:
      "Crítica constructiva al new age desde mi camino: por qué la estética espiritual puede encubrir un vacío doctrinal y cómo vuelvo a la fuente.",
    content: `
      <p>El new age promete sanación, vibras altas y manifestación. Probé prácticas, estudié discursos y detecté un patrón: <em>yo</em> como centro absoluto. Sin cruz, sin pecado, sin redención. Mucha estética, poca verdad.</p>
      <h3>Mi postura</h3>
      <ul>
        <li>Valoro el cuidado del cuerpo y la mente, pero no endioso la energía</li>
        <li>El mal existe; no todo es "frecuencia" o "intención"</li>
        <li>La verdad no se construye: se recibe y se responde con amor</li>
      </ul>
      <p>La espiritualidad sin ancla se vuelve consumo. El Evangelio, en cambio, me ancla en una Persona.</p>
    `,
    readTime: "4 min",
    tags: ["new age", "fe", "cultura", "evangelio"],
  },
  {
    id: 6,
    title: "Stack mínimo, ambición máxima",
    date: "2025-03-18",
    category: "Tecnología",
    preview:
      "Por qué priorizo React Native Web + Expo Router y Django como espina dorsal, y sólo pago nubes/LLMs cuando hay tracción real.",
    content: `
      <p>Menos superficie, menos bugs, más shipping. RN Web/Expo Router me permite compartir vistas y lógica con móvil, mientras Django da una base web sólida. La regla: <strong>no pagar hasta monetizar</strong>. Prototipar con BaaS y migrar a serverless o a Postgres gerenciado cuando duele de verdad.</p>
      <ul>
        <li>Producir UI "tipo Apple" con micro-interacciones medibles</li>
        <li>Separar core de IA del resto de la app</li>
        <li>Medir CAC/LTV desde el día 1</li>
      </ul>
      <p>La elegancia técnica es costo + foco + usuarios felices.</p>
    `,
    readTime: "3 min",
    tags: ["react native web", "django", "arquitectura", "mvp"],
  },
  {
    id: 7,
    title: "Ciberseguridad con IA: ética antes que automatización",
    date: "2025-05-28",
    category: "Ciberseguridad",
    preview:
      "Cómo uso agentes y tooling para pentesting responsable sin cruzar líneas rojas, y por qué la ética es parte del pipeline.",
    content: `
      <p>Automatizar reconocimiento y reporting con IA acelera, pero no reemplaza criterio. En mis labs documento <em>todo</em>, uso evidencia reproducible y separo entornos. La seguridad que no respeta personas y negocios no es seguridad: es ego.</p>
      <ul>
        <li>Playbooks reproducibles</li>
        <li>Auditoría y trazabilidad</li>
        <li>Consentimiento y alcance claro</li>
      </ul>
      <p>Lo que no puedo explicar con integridad, no lo ejecuto.</p>
    `,
    readTime: "4 min",
    tags: ["pentesting", "ética", "ia", "seguridad"],
  },
  {
    id: 8,
    title: "Economía del builder con IA",
    date: "2025-06-09",
    category: "Producto",
    preview:
      "Mis reglas para construir con LLMs: latencia aceptable, costos predecibles y features que realmente mueven la aguja.",
    content: `
      <p>La pregunta no es si se puede, sino si <strong>conviene</strong>. Mido costo por conversación, tasas de éxito y alternativas deterministas. A/B tests, prompts versionados y guardrails. La magia es negocio cuando reduce fricción medible.</p>
      <ul>
        <li>Elegir bien: local vs API</li>
        <li>Cachear vectores y respuestas</li>
        <li>Degradar con gracia cuando falla</li>
      </ul>
    `,
    readTime: "3 min",
    tags: ["producto", "llm", "costos", "estrategia"],
  },

  // =============================
  // Julio — Destacado
  // =============================
  {
    id: 9,
    title: "Ahora soy cristiano",
    date: "2025-07-07",
    category: "Fe",
    preview:
      "Testimonio breve de por qué decidí seguir a Cristo: menos ruido, más verdad; menos ritual vacío, más relación viva.",
    content: `
      <p>Probé caminos, teorías y estéticas. Me perdí en lo alternativo, coqueteé con misticismos, busqué poder en símbolos. Y un día entendí que la verdad no es un concepto: es una Persona.</p>
      <h3>Lo que cambió</h3>
      <ul>
        <li><strong>Autoridad:</strong> La Biblia guía mis decisiones</li>
        <li><strong>Relación:</strong> Oro a Dios directamente, con un corazón sincero</li>
        <li><strong>Gracia y verdad:</strong> No soy mejor que nadie; soy rescatado</li>
        <li><strong>Propósito:</strong> Construir tecnología que sirva, no que me sirva</li>
      </ul>
      <p>No reniego de mi pasado: lo pongo al servicio. Si sé de símbolos es para desmontar ídolos; si sé de código es para edificar. Sigo aprendiendo, pero ya no camino solo.</p>
    `,
    readTime: "5 min",
    tags: ["fe", "testimonio", "cristianismo", "propósito"],
    featured: true,
  },
];

// =============================
// Utilidades de normalización y helpers
// =============================
const fold = (s = "") =>
  s
    .toString()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // quita acentos
    .toLowerCase();

const stripHtml = (html = "") => html.replace(/<[^>]*>/g, " ");

// =============================
// Índices y catálogos
// =============================
export const blogCategories = Array.from(
  new Set(blogsData.map((b) => b.category))
).sort((a, b) => a.localeCompare(b, "es"));

export const blogTags = Array.from(
  new Set(blogsData.flatMap((b) => b.tags || []))
).sort((a, b) => a.localeCompare(b, "es"));

// =============================
// Getters básicos
// =============================
export const getAllBlogs = () => [...blogsData].sort((a, b) => new Date(b.date) - new Date(a.date));
export const getBlogById = (id) => blogsData.find((blog) => blog.id === parseInt(id));
export const getBlogsByCategory = (category) =>
  blogsData
    .filter((blog) => fold(blog.category) === fold(category))
    .sort((a, b) => new Date(b.date) - new Date(a.date));
export const getBlogsByTag = (tag) =>
  blogsData
    .filter((blog) => (blog.tags || []).some((t) => fold(t) === fold(tag)))
    .sort((a, b) => new Date(b.date) - new Date(a.date));
export const getFeaturedBlogs = () => blogsData.filter((b) => b.featured);
export const getRecentBlogs = (limit = 5) => getAllBlogs().slice(0, limit);

// Archivo/archivo mensual (YYYY-MM)
export const getArchiveIndex = () => {
  const fmt = new Intl.DateTimeFormat("es-CO", { month: "long", year: "numeric" });
  const map = new Map();
  for (const b of blogsData) {
    const d = new Date(b.date);
    const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}`;
    const label = fmt.format(d); // p. ej. "julio de 2025"
    if (!map.has(key)) map.set(key, { key, label, items: [] });
    map.get(key).items.push(b);
  }
  // ordenar por fecha descendente
  return Array.from(map.values()).sort((a, b) => (a.key < b.key ? 1 : -1));
};

// =============================
// Buscadores
// =============================
// Búsqueda simple (mejorada: sin acentos y con contenido sin HTML)
export const searchBlogs = (query) => {
  const q = fold(query);
  if (!q) return getAllBlogs();
  return blogsData.filter((blog) => {
    const haystack = [
      fold(blog.title),
      fold(blog.preview),
      fold(stripHtml(blog.content)),
      fold(blog.category),
      ...(blog.tags || []).map(fold),
    ].join(" ");
    // multi-palabra: obligamos que todas estén presentes
    const tokens = q.split(/\s+/).filter(Boolean);
    return tokens.every((t) => haystack.includes(t));
  });
};

// Búsqueda avanzada con filtros
export const searchBlogsAdvanced = ({
  query = "",
  categories = [], // ["Fe", "Tecnología"]
  tags = [], // ["mvp", "ética"]
  dateFrom = null, // "2025-01-01"
  dateTo = null, // "2025-12-31"
  featuredOnly = false,
  sort = "desc", // "desc" | "asc"
} = {}) => {
  const q = fold(query);
  const catSet = new Set(categories.map(fold));
  const tagSet = new Set(tags.map(fold));
  const from = dateFrom ? new Date(dateFrom) : null;
  const to = dateTo ? new Date(dateTo) : null;

  let result = blogsData.filter((b) => {
    if (featuredOnly && !b.featured) return false;

    if (catSet.size && !catSet.has(fold(b.category))) return false;

    if (tagSet.size) {
      const blogTagSet = new Set((b.tags || []).map(fold));
      // modo "AND": deben estar todos los tags solicitados
      for (const t of tagSet) if (!blogTagSet.has(t)) return false;
    }

    if (from && new Date(b.date) < from) return false;
    if (to && new Date(b.date) > to) return false;

    if (q) {
      const haystack = [
        fold(b.title),
        fold(b.preview),
        fold(stripHtml(b.content)),
        fold(b.category),
        ...(b.tags || []).map(fold),
      ].join(" ");
      const tokens = q.split(/\s+/).filter(Boolean);
      if (!tokens.every((t) => haystack.includes(t))) return false;
    }

    return true;
  });

  result.sort((a, b) =>
    sort === "asc" ? new Date(a.date) - new Date(b.date) : new Date(b.date) - new Date(a.date)
  );

  return result;
};

// =============================
// Paginación utilitaria
// =============================
export const paginate = (items, page = 1, perPage = 10) => {
  const total = items.length;
  const pages = Math.max(1, Math.ceil(total / perPage));
  const current = Math.min(Math.max(1, page), pages);
  const start = (current - 1) * perPage;
  const end = start + perPage;
  return {
    items: items.slice(start, end),
    page: current,
    perPage,
    total,
    pages,
  };
};